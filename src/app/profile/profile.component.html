<div class="container">
  <!-- Start Grid -->
  <div class="row">
    <!-- Full row -->
    <div
      style="padding-top: 2em; padding-bottom: 2em"
      class="col-12"
      *ngIf="userData"
    >
      <div class="jumbotron jumbotron-fluid">
        <h1 class="display-4">Welcome {{ userData.firstName }}</h1>
        <!-- Conditional Rendering based on roles -->
        <p class="lead" *ngIf="userData.roles.includes('super')">
          As a <strong>Super Admin</strong> you can edit users, groups, or chats
          from here!
        </p>
        <p
          class="lead"
          *ngIf="
            userData.roles.includes('group') &&
            !userData.roles.includes('super')
          "
        >
          As a <strong>Group Admin</strong> you can edit groups or chats from
          here!
        </p>
        <p
          class="lead"
          *ngIf="
            userData.roles.includes('chat') &&
            !userData.roles.includes('super') &&
            !userData.roles.includes('group')
          "
        >
          You can view your groups and chats from here!
        </p>
      </div>
      <hr />
    </div>

    <!-- 1/3 row -->
    <div class="col-4 d-flex flex-column align-items-center" *ngIf="userData">
      <h3 style="margin-bottom: 20px">Profile Picture</h3>
      <img
        src="{{ userData.profileImg }}"
        class="rounded-circle"
        style="width: 150px; height: 150px; margin-bottom: 15px"
        alt="Avatar"
      />
      <button
        type="button"
        style="margin-bottom: 20px"
        class="btn btn-primary mt-auto"
      >
        Upload Profile
      </button>
    </div>

    <!-- 2/3 row -->
    <div class="col-8 d-flex flex-column" *ngIf="userData">
      <h3 style="margin-bottom: 20px">Details</h3>

      <!-- Name -->
      <p>
        <strong>Name: </strong>
        <span *ngIf="!isEditMode"
          >{{ userData.firstName }} {{ userData.lastName }}</span
        >
        <input
          *ngIf="isEditMode"
          type="text"
          [(ngModel)]="userEditData.firstName"
          class="form-control"
          style="display: inline-block; width: auto"
        />
        <input
          *ngIf="isEditMode"
          type="text"
          [(ngModel)]="userEditData.lastName"
          class="form-control"
          style="display: inline-block; width: auto"
        />
      </p>

      <!-- Status -->
      <p>
        <strong>Current Status: </strong>
        <span *ngIf="!isEditMode">{{ userData.status }}</span>
        <input
          *ngIf="isEditMode"
          type="text"
          [(ngModel)]="userEditData.status"
          class="form-control"
        />
      </p>

      <!-- Username -->
      <p>
        <strong>Username: </strong>
        <span *ngIf="!isEditMode">{{ userData.username }}</span>
        <input
          *ngIf="isEditMode"
          type="text"
          [(ngModel)]="userEditData.username"
          class="form-control"
        />
      </p>

      <!-- Email -->
      <p>
        <strong>Email: </strong>
        <span *ngIf="!isEditMode">{{ userData.email }}</span>
        <input
          *ngIf="isEditMode"
          type="email"
          [(ngModel)]="userEditData.email"
          class="form-control"
        />
      </p>

      <!-- Date of Birth -->
      <p>
        <strong>Date of Birth: </strong>
        <span *ngIf="!isEditMode">{{ userData.dob }}</span>
        <input
          *ngIf="isEditMode"
          type="date"
          [(ngModel)]="userEditData.dob"
          class="form-control"
        />
      </p>

      <!-- Buttons -->
      <button
        *ngIf="!isEditMode"
        type="button"
        style="width: 110px; margin-bottom: 20px"
        class="btn btn-primary"
        (click)="toggleEditMode()"
      >
        Edit Details
      </button>

      <div *ngIf="isEditMode">
        <button
          type="button"
          style="width: 120px; margin-bottom: 20px; margin-right: 10px"
          class="btn btn-primary"
          (click)="saveDetails()"
        >
          Save Details
        </button>
        <button
          type="button"
          style="width: 110px; margin-bottom: 20px"
          class="btn btn-secondary"
          (click)="toggleEditMode()"
        >
          Cancel
        </button>
      </div>
    </div>

    <!-- Super Admin: User Management Section -->
    <div class="row" *ngIf="userData.roles.includes('super')">
      <hr />

      <div class="col-8">
        
        <h3>User Management</h3>
        <div class="row" *ngIf="allUsers?.length > 0; else noUsersTemplate">
          <div class="col-md-6 col-lg-4 card mb-3" *ngFor="let user of allUsers">
            <img
              src="{{ user.profileImg }}"
              class="rounded-circle"
              style="width: 75px; height: 75px; margin-bottom: 15px"
              alt="Avatar"
            />
            <p><strong>Username: </strong>{{ user.username }}</p>
            <p><strong>Email: </strong>{{ user.email }}</p>
            <p><strong>Roles: </strong>{{ user.roles.join(', ') }}</p>
            <div class="button-group">
              <!-- Delete Button (Visible if the active user is a Super Admin) -->
              <button
                *ngIf="userData.roles.includes('super')"
                (click)="deleteUser(user._id)"
                class="btn btn-outline-danger"
              >
                Delete
              </button>
        
              <!-- Promote to Group Admin Button (Visible if the active user is a Super Admin and the selected user is not already a Group Admin) -->
              <button
                *ngIf="userData.roles.includes('super') && !user.roles.includes('group')"
                (click)="promoteToGroupAdmin(user._id)"
                class="btn btn-outline-primary"
              >
                Promote to Group Admin
              </button>
        
              <!-- Promote to Super Admin Button (Visible if the active user is a Super Admin and the selected user is not already a Super Admin) -->
              <button
                *ngIf="userData.roles.includes('super') && !user.roles.includes('super')"
                (click)="promoteToSuperAdmin(user._id)"
                class="btn btn-outline-success"
              >
                Promote to Super Admin
              </button>
            </div>
          </div>
        </div>  

        <ng-template #noUsersTemplate>
          <div class="row">
            <p>No users yet.</p>
          </div>
        </ng-template>
      </div>

      <div class="col-4">
        <h3 style="margin-left: 10px">Create User</h3>
        <div style="margin: 10px; margin-top: 20px">
          <p>
            <strong>User Name: </strong>
            <input type="text" class="form-control" [(ngModel)]="username" />
          </p>
          <p>
            <strong>Email: </strong>
            <input type="text" class="form-control" [(ngModel)]="email" />
          </p>
          <p>
            <strong>User Password: </strong>
            <input type="text" class="form-control" [(ngModel)]="password" />
          </p>
          <button
            type="button"
            style="width: 120px; margin-bottom: 20px; margin-right: 10px"
            class="btn btn-primary"
            (click)="createUser()"
          >
            Create
          </button>
          <button
            type="button"
            style="width: 110px; margin-bottom: 20px"
            class="btn btn-secondary"
            (click)="clearCreateUser()"
          >
            Cancel
          </button>
        </div>
      </div>
    </div>

    <!-- Super Admin: Group Management Section -->
    <div class="row" *ngIf="userData.roles.includes('super') || userData.roles.includes('group')">
      <hr />

      <div class="col-8">
        <h3>Group Management</h3>
        <div class="row" *ngIf="(userData.roles.includes('super') ? allGroups.length : adminGroups.length) > 0; else noGroupsTemplate">
          <div
            class="col-md-6 col-lg-4 card mb-3"
            *ngFor="let group of userData.roles.includes('super') ? allGroups : adminGroups"
          >
            <img
              src="{{ group.groupImg }}"
              class="rounded-circle"
              style="width: 75px; height: 75px; margin-bottom: 15px"
              alt="Avatar"
              [routerLink]="['/group', group._id]"
            />
            <p>
              <strong [routerLink]="['/group', group._id]">{{
                group.name
              }}</strong>
            </p>
            <p>{{ group.description }}</p>
            <div class="button-group">
              <button
                class="btn btn-outline-danger"
                (click)="deleteGroup(group._id)"
              >
                Delete
              </button>
            </div>
          </div>
        </div>

        <ng-template #noGroupsTemplate>
          <div class="row">
            <p>No groups yet.</p>
          </div>
        </ng-template>
      </div>

      <div class="col-4">
        <h3 style="margin-left: 10px">Create Group</h3>
        <div style="margin: 10px; margin-top: 20px">
          <p>
            <strong>Group Name: </strong>
            <input type="text" class="form-control" [(ngModel)]="groupName" />
          </p>
          <p>
            <strong>Group Description: </strong>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="groupDescription"
            />
          </p>
          <button
            type="button"
            style="width: 120px; margin-bottom: 20px; margin-right: 10px"
            class="btn btn-primary"
            (click)="createGroup()"
          >
            Create
          </button>
          <button
            type="button"
            style="width: 110px; margin-bottom: 20px"
            class="btn btn-secondary"
            (click)="clearCreateUser()"
          >
            Cancel
          </button>
        </div>
      </div>
    </div>

    <!-- Shared Section for All Roles: Groups Management -->
    <div
      class="row"
      *ngIf="
        !userData.roles.includes('super')
      "
    >
      <hr />

        <div class="col-12">
          <h3>Groups You're In</h3>
          <div
            class="row"
            *ngIf="memberOnlyGroups.length > 0; else noMemberGroupsTemplate"
          >
            <div
              class="col-md-2 col-lg-3 card mb-3"
              [routerLink]="['/group', group._id]"
              *ngFor="let group of memberOnlyGroups"
            >
              <img
                src="{{ group.groupImg }}"
                class="rounded-circle"
                style="width: 75px; height: 75px; margin-bottom: 15px"
                alt="Avatar"
              />
              <p>
                <strong>{{ group.name }}</strong>
              </p>
              <p>{{ group.description }}</p>
            </div>
        </div>

        <ng-template #noMemberGroupsTemplate>
          <div class="row">
            <p>No groups yet.</p>
          </div>
        </ng-template>
      </div>

      <!-- Shared Section for All Roles: Groups Not Joined Yet -->
      <div
        class="row"
        *ngIf="
          userData.roles.includes('super') ||
          userData.roles.includes('group') ||
          userData.roles.includes('chat')
        "
      >
        <hr />

        <div class="col-12">
            <h3>Groups you're not in</h3>
            <div class="row" *ngIf="notInGroups.length > 0; else noNonGroups">
              <div
                class="col-md-2 col-lg-3 card mb-3"
                *ngFor="let group of notInGroups"
              >
                <img
                  src="{{ group.groupImg }}"
                  class="rounded-circle"
                  style="width: 75px; height: 75px; margin-bottom: 15px"
                  alt="Avatar"
                />
                <p>
                  <strong>{{ group.name }}</strong>
                </p>
                <p>{{ group.description }}</p>
                <div class="button-group">
                  <button
                    class="btn"
                    [ngClass]="
                      group.interested.includes(userData._id)
                        ? 'btn-outline-danger'
                        : 'btn-outline-primary'
                    "
                    (click)="markInterest(group)"
                  >
                    {{
                      group.interested.includes(userData._id)
                        ? "Unregister Interest"
                        : "Interested"
                    }}
                  </button>
                </div>
              </div>
          </div>
          
          <ng-template #noNonGroups>
            <div class="row">
              <p>No groups yet.</p>
            </div>
          </ng-template>

        </div>
      </div>
    </div>
  </div>
</div>
